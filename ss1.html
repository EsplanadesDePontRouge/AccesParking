<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Plan SS1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; font-family: sans-serif; }
    #map { height: 100vh; width: 100vw; }
    #retour {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <button onclick="window.history.back()" id="retour">‚Üê Retour</button>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const hauteurImage = 1000;
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2
    });

    const bounds = [[0,0], [hauteurImage,1200]];
    L.imageOverlay('EPR_SS1.png', bounds).addTo(map);
    map.fitBounds(bounds);

    const points = {
      E1: {
        nom: "Livraison E1",
        coord: [276, 190],
        chemin: [[989,520],[987,469],[690,468],[678,275],[192,278]]
      },
      E2: {
        nom: "Livraison E2",
        coord: [224, 887],
        chemin: [[989,520],[987,469],[690,468],[678,275],[889,270],[888,224]]
      },
      E3: {
        nom: "Livraison E3",
        coord: [748, 857],
        chemin: [[989,520],[987,469],[803,472],[812,754],[851,751]]
      },
      ALTO: {
        nom: "Livraison ALTO",
        coord: [544, 292],
        chemin: [[989,520],[987,469],[690,468],[678,275],[299,277],[294,550]]
      }
    };

    function afficherChemin(code) {
      const p = points[code];
      if (!p) return;

      const cheminCorrige = p.chemin.map(([x, y]) => [hauteurImage - y, x]);
      const coordCorrigee = [hauteurImage - p.coord[0], p.coord[1]];

      L.polyline(cheminCorrige, {
        color: 'blue',
        weight: 4,
        opacity: 0.7
      }).addTo(map);

      L.marker(coordCorrigee)
        .addTo(map)
        .bindPopup(p.nom)
        .openPopup();
    }

    window.addEventListener('load', () => {
      const params = new URLSearchParams(window.location.search);
      const livraison = params.get('livraison');
      if (livraison && points[livraison]) {
        afficherChemin(livraison);
      }
    });
  </script>
</body>
</html>
